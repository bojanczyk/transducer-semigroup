
\documentclass[a4paper,UKenglish,cleveref, autoref, thm-restate, numberwithinsect]{lipics-v2021}
%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"

\pdfoutput=1 %uncomment to ensure pdflatex processing (mandatatory e.g. to submit to arXiv)
\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\bibliographystyle{plainurl}% the mandatory bibstyle

\title{A Categorical Perspective on Regular Functions} %TODO Please add

%\titlerunning{Dummy short title} %TODO optional, please use if title is longer than one line

\author{Mikołaj Bojańczyk}{Institute of Informatics, University of Warsaw, Poland \and \url{https://www.mimuw.edu.pl/~bojan/}}{bojan@mimuw.edu.pl}{}{{\color{red}(Optional) author-specific funding acknowledgements}}%TODO mandatory, please use full name; only 1 author per \author macro; first two parameters are mandatory, other parameters can be empty. Please provide at least the name of the affiliation and the country. The full address is optional. Use additional curly braces to indicate the correct name splitting when the last name consists of multiple name parts.

\author{Lê Thành Dũng (Tito) Nguy\~{\^e}n}{École normale supérieure de Lyon, France \and \url{https://nguyentito.eu/}}{nltd@nguyentito.eu}{https://orcid.org/0000-0002-6900-5577}{Supported by the LABEX MILYON (ANR-10-LABX-0070) of Université de Lyon, within the program \enquote{Investissements d'Avenir} (ANR-11-IDEX-0007) operated by the French National Research Agency (ANR).}

\authorrunning{M.~Bojańczyk and L.~T.~D.~Nguy\~{\^e}n} %TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'

\Copyright{Mikołaj Bojańczyk and Lê Thành Dũng Nguy\~{\^e}n} %TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/

\ccsdesc[500]{Theory of computation~Transducers} %TODO mandatory: Please choose ACM 2012 classifications from https://dl.acm.org/ccs/ccs_flat.cfm 


\keywords{Dummy keyword} %TODO mandatory; please add comma-separated list of keywords

\category{} %optional, e.g. invited paper

\relatedversion{} %optional, e.g. full version hosted on arXiv, HAL, or other respository/website
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

%\supplement{}%optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...
%\supplementdetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93, subcategory={Description, Subcategory}, swhid={Software Heritage Identifier}]{General Classification (e.g. Software, Dataset, Model, ...)}{URL to related version} %linktext, cite, and subcategory are optional

%\funding{(Optional) general funding statement \dots}%optional, to capture a funding statement, which applies to all authors. Please enter author specific funding statements as fifth argument of the \author macro.

%\acknowledgements{I want to thank \dots}%optional

\nolinenumbers %uncomment to disable line numbering



%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
\EventShortTitle{CVIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{csquotes}
\usepackage{mathtools}
\usepackage{quiver}
\usepackage{tikz-cd}
\usepackage{xspace}

\usepackage{todonotes}
\newcommand{\tito}[1]{\todo[inline,color=green!40]{Tito --- #1}}
\usepackage{macros}


\begin{document}

\maketitle

%TODO mandatory: add short abstract of the document
\begin{abstract}
    We consider regular string-to-string functions, i.e.~functions that are recognized by copyless streaming string transducers, or  any of their equivalent models, such as deterministic two-way automata. We give yet another characterization, which is very succinct: finiteness-preserving functors from the category of semigroups to itself, together with a certain output function that is a natural transformation.
\end{abstract}

\newcommand{\moncat}{\mathrm{Mon}}
\newcommand{\semcat}{\mathrm{Sem}}

\input{intro}
\input{transducer-semigroup}
\input{output-monoid}



%%
%% Bibliography
%%
pp
%% Please use bibtex, 

\bibliography{bib}

\appendix

\section{Regular functions over arbitrary semigroups}

Instead of just \enquote{transducer semigroups} we're going to prepend the adjective \enquote{functorial}, to distinguish them from the new \enquote{register transducer semigroups}. The notion of regular semigroup-to-semigroup function that we consider is closed under composition (\Cref{rem:composition}) and when the codomain is finite, it coincides with recognizable functions.

\subsection{Register transducer semigroups}

\tito{Probably in the final paper it would be nice to introduce these things without invoking categories at first, to make the paper more welcoming}

\begin{definition}
    A \emph{finitary semigroup with registers} consists of a finite semigroup $S$, a family $(R_s){s\in S}$ of finite nonempty sets, and a dependent function
    \[ (s_1, s_2 : S) \to R_{s_1 s_2} \to (R_{s_1} + R_{s_2})^+ \]
    such that blah blah\ldots{} It induces the finite polynomial functor from semigroups to sets
    \[ A \mapsto \sum_{s\in S} A^{R_s} \]
    which can be turned into a functor from semigroups to semigroups thanks to the dependent function above.
\end{definition}

Equivalently, consider the following symmetric monoidal category:
\begin{description}
    \item[Objects:] finite polynomial functors (in one variable).
    \item[Morphisms:] natural transformations.
    \item[Monoidal product:] pointwise cartesian product of sets.
\end{description}
A finitary semigroup with registers is the same thing as a \enquote{semigroup object} (defined by removing the unit requirement from monoid objects) in this monoidal category of finite polynomial functors.

\begin{definition}
    A \emph{register transducer semigroup} is a finitary semigroup with registers, plus a dependent function
    \[ (s : S) \to (R_s)^+ \]
\end{definition}

This is equivalent to specifying a natural transformation from our polynomial functor to the forgetful functor, so it induces a functorial transducer semigroup in the expected way.

\begin{definition}
    A \emph{regular function} from $A$ to $B$ (both semigroups) is one that is recognized by the functorial transducer semigroup induced by some 
\end{definition}

\begin{theorem}
    When $A$ and $B$ are free monoids, this coincides with the usual notion.
\end{theorem}
\begin{proof}[Proof idea]
    Easy direction: take the substitution transition monoid~\cite{AperiodicSST} of a bounded-copy SST. (This requires some care to handle the output letters produced not by a transition but by the final output function; they can be stored in specific constant registers that are initialized in the image of all words, including the empty word -- for this, it is important that we can use a morphism of semigroups that is not necessarily a morphism of monoids.)
    
    Conversely, from a register transducer semigroup one can define an SST, and thanks to associativity(!) turns out that it's automatically bounded-copy.
\end{proof}

\begin{remark}
This should also work if we have a single finite nonempty set of registers $R$ for all semigroup elements instead of a family $(R_s)_{s\in S}$ though the equivalence proof is slightly less immediate for semigroups than for monoids (you need to use the output function to produce \enquote{default} elements with which to fill unused registers). Note that the \enquote{substitution transition monoid} operation \enquote{naturally} produces something with a varying register set.
\end{remark}

\subsection{Equivalence with functorial transducer semigroups}

It is immediate that every regular function is recognized by a finiteness-preserving functorial transducer semigroup, because finite polynomial functors are finiteness-preserving. We shall therefore focus on the converse.

\begin{theorem}
  For every finiteness-preserving functorial transducer semigroup $(\functor, \outfun)$, there is another one $(\functor',\outfun')$
  \begin{itemize}
    \item which is induced by some register transducer semigroup,
    \item and which admits a natural transformation $\eta : \functor \Rightarrow \functor'$ such that $\outfun = \outfun' \circ \eta$.
  \end{itemize}
  Hence every function recognized by $(\functor,\outfun)$ is also recognized by $(\functor',\outfun')$ (by the second item) and thus is regular (by the first item).
\end{theorem}
\begin{proof}
    Let $(\functor,\outfun)$ be a functorial transducer semigroup, and suppose $\functor$ preserves finiteness, so $\functor1$ is finite. We first build a finitary semigroup with registers that doesn't entirely fulfill our objectives, but still contains the core mechanism: $S = \functor1$, and for $s\in S$,
    \[ R_s = \sum_{l,r \in F(1)} \{\text{occurrences of}\ \mathtt{m}\ \text{in}\ (\text{factorized output of}\ (l,s,r)) \in 1\oplus1\oplus1 \cong \{\mathtt{l,m,r}\}^+\} \]
    For $s_1,s_2\in S$ we must now define a map $R_{s_1 s_2} \to (R_{s_1} + R_{s_2})^+$ describing the register recombination during a product. We derive it from the correspondence between
    \begin{itemize}
        \item the occurrences of $\mathtt{m}$ in the factorized output of $l \cdot (s_1 s_2)\cdot r$
        \item and the maximal factors in $\{\mathtt{m_1,m_2}\}^+$ inside
        \[ (\text{factorized output of}\ (l,s_1,s_2,r)) \in 1\oplus1\oplus1\oplus1 \cong \{\mathtt{l,m_1,m_2,r}\}^+ \]
    \end{itemize}
    Indeed, the morphism $1\oplus\mathop{!}\oplus1$ where $! : 1\oplus1 \to 1$ is the terminal morphism sends the maximal factors in $\{\mathtt{m_1,m_2}\}^+$ to $\mathtt{m}$ and is the identity on $\mathtt{l,r}$. To see that applying this to the factorized output of $(l,s_1,s_2,r)$ indeed yields the factorized output of $(l,s,r)$, we need to use naturality in some way
    \tito{TODO above}

    We must also check that this operation is \enquote{associative}. For this, consider the factorized output of $(l,s_1,s_2,s_3,r)$ \ldots{}

    Finally we define $\widehat\eta : \functor \Rightarrow \functorg$ where $\functorg$ is the functor induced by our semigroup with registers. For any $x \in \functor A$, apply $\functor! : \functor A \to \functor 1$ to get some $s \in S$. Then look at the factorized output of $(l,x,r)$ in $1\oplus A \oplus 1$ for each $(l,r)\in (\functor1)^2$ to get register values in $A^{R_s}$.

    The issue is that the output function for $\functor$ may not factor through $\widehat\eta$. To remediate that, we consider instead another semigroup with registers, inducing the functor $\functor'$, with the same underlying semigroup $S=\functor1$ and bigger register sets
    \[ R'_s = \{\bullet\} + R^{\mathrm{left}}_s + R^{\mathrm{right}}_s + R_s \quad\text{for}\ s\in S\]
    where $R^{\mathrm{left}}_s$ is the sum over $r \in \functor1$ of the sets of occurrences of $\mathtt{l}$ in the factorized output of $(s,r)$ which is in $1\oplus1\cong\{\mathtt{l,r}\}^+$, etc. Thus
    \[ \functor'A \cong \sum_{s\in S} A \times A^{R^{\mathrm{left}}_s} \times \dots \cong A \times \sum_{s\in S} A^{R^{\mathrm{left}}_s} \times \dots \]
    and we have then: $\outfun_A = (\text{left projection on}\ A) \circ \eta$ for the definition of $\eta$ extending $\widehat\eta$ in the obvious way.
\end{proof}


\end{document}
